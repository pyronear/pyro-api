Enum "userrole" {
  "admin"
  "agent"
  "user"
}

Enum "annotationtype" {
  "wildfire_smoke"
  "other_smoke"
  "other"
}

Table "organizations" as O {
  "id" int [not null]
  "name" varchar [not null]
  "telegram_id" varchar
  "slack_hook" varchar

  Indexes {
    (id) [pk]
  }
}

Table "users" as U {
  "id" int [not null]
  "organization_id" int [ref: > O.id, not null]
  "role" userrole [not null]
  "login" varchar [not null]
  "hashed_password" varchar [not null]
  "created_at" timestamp [not null]

  Indexes {
    (id, login) [pk]
  }
}

Table "cameras" as C {
  "id" int [not null]
  "organization_id" int [ref: > O.id, not null]
  "name" varchar [not null]
  "angle_of_view" float [not null]
  "elevation" float [not null]
  "lat" float [not null]
  "lon" float [not null]
  "is_trustable" bool [not null]
  "created_at" timestamp [not null]
  "last_active_at" timestamp
  "last_image" varchar

  Indexes {
    (id) [pk]
  }
}

Table "poses" as P {
  "id" int [not null]
  "camera_id" int [ref: > C.id, not null]
  "azimuth" float [not null]
  "patrol_id" int

  Indexes {
    (id) [pk]
  }
}

Table "sequences" as S {
  "id" int [not null]
  "camera_id" int [ref: > C.id, not null]
  "pose_id" int [ref: > P.id]
  "camera_azimuth" float [not null]
  "sequence_azimuth" float
  "cone_angle" float
  "is_wildfire" annotationtype
  "started_at" timestamp [not null]
  "last_seen_at" timestamp [not null]

  Indexes {
    (id) [pk]
  }
}

Table "detections" as D {
  "id" int [not null]
  "camera_id" int [ref: > C.id, not null]
  "pose_id" int [ref: > P.id, not null]
  "sequence_id" int [ref: > S.id]
  "bucket_key" varchar [not null]
  "bbox" varchar [not null]
  "others_bboxes" varchar
  "created_at" timestamp [not null]

  Indexes {
    (id) [pk]
  }
}

Table "webhooks" as W {
  "id" int [not null]
  "url" varchar [not null]

  Indexes {
    (id) [pk]
  }
}

Table "occlusion_masks" as OM {
  "id" int [not null]
  "pose_id" int [ref: > P.id, not null]
  "mask" varchar [not null]
  "created_at" timestamp [not null]

  Indexes {
    (id) [pk]
  }
}

Table "alerts" as A {
  "id" int [not null]
  "organization_id" int [ref: > O.id, not null]
  "lat" float
  "lon" float
  "started_at" timestamp [not null]
  "last_seen_at" timestamp [not null]

  Indexes {
    (id) [pk]
  }
}

Table "alerts_sequences" as AS {
  "alert_id" int [ref: > A.id, not null]
  "sequence_id" int [ref: > S.id, not null]

  Indexes {
    (alert_id, sequence_id) [pk]
  }
}
